<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MagnetFlix</title>
  <style>
    body {
      margin: 0;
      background-color: #141414;
      font-family: Arial, sans-serif;
      color: #fff;
    }

    header {
      padding: 1rem;
      background-color: #000;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
    }

    input[type="text"], select {
      padding: 0.5rem;
      border-radius: 4px;
      border: none;
      margin-left: 1rem;
    }

    #catalog {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }

    .card {
      background-color: #1f1f1f;
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .card:hover {
      transform: scale(1.05);
    }

    .card img {
      width: 100%;
      height: 225px;
      object-fit: cover;
    }

    .card-content {
      padding: 0.5rem;
    }

    .card-content h3 {
      margin: 0;
      font-size: 1rem;
    }

    .card-content p {
      font-size: 0.8rem;
      color: #ccc;
    }
  </style>
</head>
<body>
  <header>
    <h1>üé¨ MagnetFlix</h1>
    <div>
      <input type="text" id="searchInput" placeholder="Buscar t√≠tulo..." />
      <select id="yearFilter">
        <option value="">Todos los a√±os</option>
      </select>
    </div>
  </header>

  <main id="catalog"></main>

  <script>
    const API_KEY = "60e9fcee1aaa6bdcb3a9bbc60ac87c59"; // Reemplaza con tu API KEY de TMDb
    const searchInput = document.getElementById("searchInput");
    const yearFilter = document.getElementById("yearFilter");
    const container = document.getElementById("catalog");

    const items = [
      { imdb: "tt1001526", magnet: "magnet:?xt=urn:btih:..." }, // Megamente
      { imdb: "tt3896198", magnet: "magnet:?xt=urn:btih:..." }, // Guardianes
      { imdb: "tt0944947", magnet: "magnet:?xt=urn:btih:..." }, // GOT
      { imdb: "tt0903747", magnet: "magnet:?xt=urn:btih:..." }, // BB
    ];

    async function fetchDetails(imdbID) {
      const res = await fetch(`https://api.themoviedb.org/3/find/${imdbID}?api_key=${API_KEY}&language=es-ES&external_source=imdb_id`);
      const data = await res.json();
      const movie = data.movie_results[0] || data.tv_results[0];
      return movie;
    }

    async function renderCard(item) {
      const movie = await fetchDetails(item.imdb);
      if (!movie) return;

      const title = movie.title || movie.name;
      const description = movie.overview || "Sin descripci√≥n";
      const year = (movie.release_date || movie.first_air_date || "").split("-")[0];
      const image = movie.poster_path
        ? `https://image.tmdb.org/t/p/w500${movie.poster_path}`
        : "https://via.placeholder.com/300x450?text=Sin+imagen";

      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img src="${image}" alt="${title}">
        <div class="card-content">
          <h3>${title}</h3>
          <p>${description.slice(0, 100)}...</p>
          <p><small>${year}</small></p>
        </div>
      `;

      card.addEventListener("click", () => {
        window.open(item.magnet, "_blank");
      });

      card.dataset.title = title.toLowerCase();
      card.dataset.year = year;

      container.appendChild(card);
    }

    async function loadCatalog() {
      container.innerHTML = "";
      for (const item of items) {
        await renderCard(item);
      }
      populateYearFilter();
    }

    function populateYearFilter() {
      const years = Array.from(document.querySelectorAll(".card")).map(card => card.dataset.year);
      const uniqueYears = [...new Set(years)].filter(Boolean).sort((a, b) => b - a);
      yearFilter.innerHTML = `<option value="">Todos los a√±os</option>`;
      uniqueYears.forEach(y => {
        const option = document.createElement("option");
        option.value = y;
        option.textContent = y;
        yearFilter.appendChild(option);
      });
    }

    function applyFilters() {
      const query = searchInput.value.toLowerCase();
      const year = yearFilter.value;

      document.querySelectorAll(".card").forEach(card => {
        const matchesTitle = card.dataset.title.includes(query);
        const matchesYear = year ? card.dataset.year === year : true;
        card.style.display = matchesTitle && matchesYear ? "block" : "none";
      });
    }

    searchInput.addEventListener("input", applyFilters);
    yearFilter.addEventListener("change", applyFilters);

    loadCatalog();
  </script>
</body>
</html>
